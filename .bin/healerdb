#!/usr/bin/env /ptv/healer/healerdb-py/.venv/bin/python3
# -*- coding: utf-8 -*-
import os, sys
import mod_dbquery as dbquery
from rich import print
from rich.console import Console
from rich.markdown import Markdown
from rich.theme import Theme
from rich.emoji import Emoji
import mod_utils as myutils
from mod_utils import *

# Clear the terminal screen
clear()

# Set up rich 
console = Console()

# Logo string
logo = """# HealerDB
## A CLI Tool to manage the database of Healer
### For Help, just run the command with the -h flag: `healerdb -h`
#### Made with :brain:  and :muscle:  by [Autherix](https://github.com/autherix)
##### By :handshake:  with: [Barbod](https://)
"""

# print the logo
mdview(logo)

seperator()

# define connection string
connHostPort = "localhost:27017"
connUsername = "healerdb"
connSecret = "hamidpapi"
connstr = "mongodb://"+connUsername+":"+connSecret+"@"+connHostPort+"/"
print("Connecting to mongodb server on: \n" + str(connHostPort))
seperator()

# Create a client to the mongodb database using the connstr 
client, err = dbquery.CreateClient(connstr)
if err != None:
    print("Main: CreateClient: err: \n", err)
    sys.exit(1)

# Purge all the databases except admin and config
err = dbquery.PurgeDatabases(client)
if err != None:
    print("Main: PurgeDatabases: err: \n", err)
    # sys.exit(1)

# Create a database called 'enum'
dbname = "enum"
err = dbquery.CreateDatabase(client, dbname)
if err != None:
    print("Main: CreateDatabase: err: \n", err)
    # sys.exit(1)

# Create a target called 'target1'
collname = "target1"
err = dbquery.AddTarget(client, dbname, collname)
if err != None:
    print("Main: AddTarget: err: \n", err)
    # sys.exit(1)

# Create a target called 'target2'
collname = "target2"
err = dbquery.AddTarget(client, dbname, collname)
if err != None:
    print("Main: AddTarget: err: \n", err)
    # sys.exit(1)

# List all databases names and print them
dbs, err = dbquery.GetDatabases(client)
if err != None:
    print("Main: GetDatabases: err: \n", err)
    # sys.exit(1)

# List all collection names in database 'enum' and print them
colls, err = dbquery.GetCollections(client, dbname)
if err != None:
    print("Main: GetCollections: err: \n", err)
    # sys.exit(1)
print("Main: GetCollections: colls: \n"+ str(colls))


#!/usr/bin/env /ptv/healer/healerdb-py/.venv/bin/python3
# -*- coding: utf-8 -*-
import os, sys, inspect
import mod_dbquery as dbquery
from rich.console import Console
from rich.markdown import Markdown
from rich.theme import Theme
from rich.emoji import Emoji
from absl import app
from absl import flags
from absl.testing import absltest
# import fancyflags as ff
import mod_utils as myutils
from mod_utils import *
import mod_flags as flagger

# Clear the terminal screen
clear()

# Set up rich
console = Console()

# Logo string
logo = """# HealerDB
## A CLI Tool to manage the database of Healer
### For Help, just run the command with the -h flag: `healerdb -h`
##### Made with :brain:  and :muscle:  by [Autherix](https://github.com/autherix)
###### By :handshake:  with: [Barbod](https://github.com/dark190)
"""
# print the logo
mdview(logo)
seperator()

# Flags
allFlags = flagger.ArgParser(sys.argv)

# Define config 
config, err = myutils.loadYamlConfig()
if err != None:
    print(parseError(err))
rprint("Config loaded successfully")

dbconfig = config["database"]
db_base_url = dbconfig["url"]["base_url"]
db_username = dbconfig["url"]["creds"]["username"]
db_password = dbconfig["url"]["creds"]["password"]
db_host = dbconfig["url"]["host"]
db_port = str(dbconfig["url"]["port"])
connstr = db_base_url + db_username + ":" + db_password + "@" + db_host + ":" + db_port + "/"
rprint("Connecting to mongodb server on: \n" + db_host + ":" + db_port)
seperator()

# Create a client and ping the database
client, err = dbquery.CreateClient(connstr)
if err != None:
    print(parseError(err))

pingResult, err = dbquery.pingDB(client)
if err != None:
    print(parseError(err))
rprint("Ping result: " + str(pingResult))
seperator()

# Exit the client
exitResult, err = dbquery.ExitClient(client)
if err != None:
    print(parseError(err))
rprint("Client exit result: " + str(exitResult))
seperator()